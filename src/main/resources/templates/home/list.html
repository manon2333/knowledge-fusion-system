<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name=renderer  content=webkit>
    <title>标注系统</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css">
    <link rel="stylesheet" href="/style/common.css">
    <script type="application/javascript" src="/js/jquery.min.js"></script>
    <script type="application/javascript" src="/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/lib/layui/layui.js"></script>
    <script type="application/javascript" src="/lib/echarts/echarts.min.js"></script>
    <script type="application/javascript" src="/js/g6.min.js"></script>
    <script type="text/javascript" src="/js/statistic.js"></script>
    <script type="text/javascript" src="/js/dataReport.js"></script>
</head>
<body class="comment">
<!-- 载入左侧菜单指向的jsp（或html等）页面内容 -->
<div class="" id="content">
    <div class="header clearfix">
        <div class="title fl"><a href="/home/index.html">标注系统</a></div>
        <form class="layui-form fl" action="javascript:;" id="search" lay-filter="formTest" >
            <div class="layui-inline inp_200">
                <div class="layui-input-inline">
                    <select name="entityType" class="xzs" lay-search lay-filter="sxType">
<!--                        <option value="不限定">不限</option>-->
<!--                        <option value="航空母舰">航空母舰</option>-->
<!--                        <option value="基地">基地</option>-->
<!--                        <option value="飞机">飞机</option>-->
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-inline inp_400">
                    <input type="text" name="keyword" placeholder="请输入实体名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-inline">
                  <button class="layui-btn layui-btn-normal serBtn" lay-submit lay-filter="formDemo">检索实体</button>
                    <a class="shtjtz" href="/home/sltj.html">数量统计</a>
                </div>
            </div>
            <br>
            <div id="gjSx" style="display:none; margin-top:20px;">
                <div class="layui-inline inp_200">
                    <div class="layui-input-inline">
                        <select name="entitySx" class="sxxz" lay-search >
                            <option value="">不限</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline gjsxWh">
                    <div class="layui-input-inline">
                        <input type="number" name="sxMin" placeholder="请输入最小值" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <input type="number" name="sxMax" placeholder="请输入最大值" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="contBox" id="container">
        <div class="layui-row layui-col-space15">
          <div class="layui-col-xs8">

            <div class="cBox box_l">
              <div class="sub">
                <div class="sub_head list">
                  <h3>检索结果</h3>
                  <span class="fr counts"></span>
                </div>
                <ul class="sub_list">
<!--                  <li>-->
<!--                    <h5><b class="logo-01">舰</b><a href="javascript:;">尼米兹级核动力航空母舰</a></h5>-->
<!--                    <div class="sl_con">-->
<!--                      <img src="/images/hm_02.jpg" alt="">-->
<!--                      <div class="slc">-->
<!--                        <div>-->
<!--&lt;!&ndash;-->
<!--                        尼米兹级核动力航空母舰（英语：Nimitz Class Aircraft Carrier）是美国海军所使用的多用途超级航空母舰同时也是美国海军新世代的航空母舰，为美国海军第二代核动力航空母舰。-->
<!--&ndash;&gt;-->
<!--                        </div>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                  </li>-->
                </ul>
                <div id="demo1" style="text-align:center; margin-top:20px;"></div>
              </div>
            </div>
          </div>
          <div class="layui-col-xs4">
            <div class="cBox box_r">
              <div class="rb_list queList1">
                <div class="cb_nav clearfix">
                  <h5 class="entType"></h5>
                  <!-- <div class="fr">
                    <span class="">展开</span>
                  </div> -->

                </div>
                <ul class="clearfix cbl_ul">
                </ul>
              </div>
              <div class="rb_list queList2">
                <div class="cb_nav clearfix">
                  <h5 class="entType"></h5>
                  <!--<div class="fr">
                    <span class="">展开</span>
                  </div>-->
                </div>
                <ul class="clearfix cbl_ul">
<!--                  <li>-->
<!--                    <a href="javascript:;">-->
<!--                      <img src="/images/hm_02.jpg" alt="">-->
<!--                      <h6>福特级航空母舰</h6>-->
<!--                    </a>-->
<!--                  </li>-->
                </ul>
              </div>
              <!--<div class="rb_list">
                <div class="cb_nav clearfix">
                  <h5>同类关联实体</h5>
                  <div class="fr">
                    <span class="">排序方式</span>
                    <form class="layui-form" style="display:inline-block;" >
                      <div class="layui-input-inline" style="width:80px;">
                        <select name="interest" lay-filter="aihao">
                          <option value="开始时间">开始时间</option>
                          <option value="结束时间">结束时间</option>
                        </select>
                      </div>
                    </form>
                  </div>
                </div>
                <ul class="layui-timeline">
                  <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                    <div class="layui-timeline-content layui-text ls_box">
                      <h3 class="layui-timeline-title"><a href="javascript:;">8月18日</a> <span class="fr"><b></b><a href="javascript:;">西奥多·罗斯福号航空母舰</a> ，<a href="javascript:;">疫情</a> ，<a href="javascript:;">越南港口</a>，<a href="javascript:;">美国</a></span></h3>
                      <h5><a href="javascript:;">美军认定2个事实:罗斯福号航母在越南被感染，老舰长永不录用</a></h5>
                      <div class="layui-row">
                        <div class="layui-col-md3 ls_01">
                          <img src="/images/hm_02.jpg" alt="">
                        </div>
                        <div class="layui-col-md9 ls_02">
                          <div class="ls_02">
                            <h6>
                              <img src="/images/sign_02.png" alt="">
                              <span>北晚新视觉网 2020年06月09日 08:59</span>
                            </h6>
                            <div class="ls_con">
                              中新网6月9日电 据路透社报道，当地时间6月9日，美国三名官员表示当地时间6月9日，美国三名官员表示当地时间6月9日，美国三名官员表示当地时间6月9日，美国三名官员表示 
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <li class="layui-timeline-item">
                    &lt;!&ndash; <i class="layui-icon layui-timeline-axis">&#xe63f;</i> &ndash;&gt;
                    <div class="layui-timeline-content layui-text">
                      <div class="layui-timeline-title"></div>
                    </div>
                  </li>
                </ul>
              </div>-->
            </div>
          </div>
        </div>
    </div>
</div>
<script>
var keyword = getUrlParam('keyword'); //总页数
var count = 70; //总页数
var single = 10; //每页页数
var page = 1; //页码
layui.use(['form','layer','laypage'], function(){
    // console.log(entityType);
    // console.log(keyword);
    var form = layui.form;
    var layer = layui.layer;
    var laypage = layui.laypage;
    $('input[name=keyword]').val(keyword);
    $('input[name=sxMin]').val(sxMin);
    $('input[name=sxMax]').val(sxMax);

    entTypeList();
    getStSxFn(entityType);
    form.render();

    // serach(entityType,keyword,single,page);
    serach(entityType,keyword,entitySx,sxMin,sxMax,single,page);

});

function serach(entityType,keyword,propertyName,minPropertyValue,maxPropertyValue,results,page){

    $.ajax({
        // url:'/query/entkw',
        url:'/query/entkwProperty',
        type:'post',
        // data:{entityType:entityType,kw:keyword,results:results,page:page},
        data:{entityType:entityType,kw:keyword,propertyName:propertyName,minPropertyValue:minPropertyValue,maxPropertyValue:maxPropertyValue,results:results,page:page},
        success:function(msg){
            if(msg.success) {
                var data = JSON.parse(msg.json);
                console.log(data);
                var str = '';
                var des = '';
                for(var i=0; i<data.entityList.length; i++){

                    if(data.entityList[i].description == undefined){
                        des = '暂无数据'
                    }else{
                        des = data.entityList[i].description;
                    }
                    var imgSrc = data.entityList[i].picture ? data.entityList[i].picture : '/images/img404.png';
                    str += '<li>' +
                      '<h5><b class="logo-01">' + data.entityList[i].entityType.charAt(data.entityList[i].entityType.length-1) + '</b><a href="/home/content.html?id=' + data.entityList[i].id + '&latest=' + data.entityList[i].latest + '&version=' + data.entityList[i].version + '&entityType=' + data.entityList[i].entityType + '" target="_blank">' + data.entityList[i].name + '</a></h5>' +
                      '<div class="sl_con">' +
                      '<img src="' + imgSrc + '" alt="' + data.entityList[i].name + '">' +
                      '<div class="slc">' +
                          '<div>' + des + '</div>' +
                      '</div>' +
                      '</div>' +
                    '</li>';

                }

                $('.sub_list').html(str);

                setPages(data.total,data.time,results,page,data.precise);
                showGlst(data);
            }else{
                layer.msg(msg.errMsg);
            }
        },
        error:function(err){
            console.log(err);
        }
    });
}
function setPages(total,time,results,page,precise){
    count = total;
    if(precise){
        $('.counts').text('本次检索共用时' + time + '毫秒，检索结果共 ' + total + ' 条');
    }else{
        $('.counts').text('本次检索共用时' + time + '毫秒，检索结果约 ' + total + ' 条');
    }


    layui.use(['form','laypage'], function() {
        var form = layui.form;
        var laypage = layui.laypage;

        /* 分页 */
        laypage.render({
            elem: 'demo1'
            ,count: count //数据总数
            ,limit:results
            ,curr:page
            // ,layout:['prev', 'page', 'next', 'skip']
            ,jump: function(obj, first){
                // console.log(obj);
                // return false;
                if(!first){
                    //do something
                    page = obj.curr;
                    // serach(entityType,keyword,results,page)
                    serach(entityType,keyword,entitySx,sxMin,sxMax,results,page);
                }

            }
        });

        form.render('checkbox');
    });
}
</script>
</body>
</html>